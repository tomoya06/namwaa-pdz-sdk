"use strict";var __importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t};Object.defineProperty(exports,"__esModule",{value:!0});var HANDTYPE,_=__importStar(require("lodash"));!function(e){e[e.Fake=-1]="Fake",e[e.Single=1]="Single",e[e.Double=2]="Double",e[e.Five=5]="Five",e[e.Flush=6]="Flush",e[e.Straight=7]="Straight",e[e.House=8]="House",e[e.Four=9]="Four",e[e.FS=10]="FS"}(HANDTYPE=exports.HANDTYPE||(exports.HANDTYPE={}));var allNumbers=_.range(13).map(function(e){return String.fromCharCode(97+e)}),allColors=_.range(4).map(function(e){return String.fromCharCode(65+e)}),allPoints=["A","2","3","4","5","6","7","8","9","10","J","Q","K"],allSuits=["diamonds","clubs","hearts","spades"],allCards=_.flatten(allNumbers.map(function(t){return allColors.map(function(e){return""+t+e})}));exports.MIN_4="aA",exports.BIG_A="kD",exports.BIG_3="mD";var FAKE_HAND={dominant:"",type:HANDTYPE.Fake};function shuffleCards(){var e=_.shuffle(allCards),t=Math.floor(e.indexOf(exports.MIN_4)/13);return{hands:[e.slice(0,13).sort(),e.slice(13,26).sort(),e.slice(26,39).sort(),e.slice(39,52).sort()],starter:t}}function digestSingle(e){return 1!==e.length?FAKE_HAND:{dominant:e[0],type:HANDTYPE.Single}}function digestDouble(e){return 2!==e.length?FAKE_HAND:e[0][0]!==e[1][0]?FAKE_HAND:{dominant:_.max(e)||e[0],type:HANDTYPE.Double}}function digestFives(e){if(5!==e.length)return FAKE_HAND;var t,r=_.sortBy(e),n=!1,a=_.map(r,function(e){return e[1]});t=1===_.uniq(a).length;var i=[];i=_.concat(i,r.map(function(e){return e.charCodeAt(0)})),i=_.concat(i,r.map(function(e){return e.charCodeAt(0)+13}));for(var o=0,s=0,u=0;u<9;u++)if(i[u+1]-i[u]==1?o++:o=0,4===o){s=(u+1)%5,n=!0;break}if(n&&t)return{dominant:r[s],type:HANDTYPE.FS};if(n)return{dominant:r[s],type:HANDTYPE.Straight};if(t)return{dominant:r[4],type:HANDTYPE.Flush};var l={};if(r.forEach(function(e){_.includes(Object.keys(l),e[0])?l[e[0]].push(e):l[e[0]]=[e]}),2!==Object.keys(l).length)return FAKE_HAND;var d=_.values(l);switch(d[0].length){case 2:case 3:return{dominant:_.max(d[3-d[0].length])||"",type:HANDTYPE.House};case 1:case 4:return{dominant:_.max(d[4-d[0].length>>1])||"",type:HANDTYPE.Four};default:return FAKE_HAND}}function digestHand(t){if(_.uniq(t).length!==t.length)return FAKE_HAND;if(!_.every(t,function(e){return 2===e.length&&e[0]<="m"&&"a"<=t[0]&&e[1]<="D"&&"A"<=e[1]}))return FAKE_HAND;switch(t.length){case 1:return digestSingle(t);case 2:return digestDouble(t);case 5:return digestFives(t);default:return FAKE_HAND}}function compareHands(e,t){if(0!==t.length&&t.length!==e.length)return!1;if(0===t.length)return _.includes(e,exports.MIN_4)&&digestHand(e).type!==HANDTYPE.Fake;var r=digestHand(e),n=digestHand(t);switch(e.length){case 1:return e[0]>t[0];case 2:return r.dominant>n.dominant;case 5:return r.type>n.type||r.type===n.type&&(r.type===HANDTYPE.Flush||r.type===HANDTYPE.FS)&&(r.dominant[1]>n.dominant[1]||r.dominant[1]===n.dominant[1]&&r.dominant>n.dominant)||r.type===n.type&&r.type!==HANDTYPE.Flush&&r.type!==HANDTYPE.FS&&r.dominant>n.dominant}return!1}function cardDecoder(e){var t=allNumbers.indexOf(e.charAt(0)),r=allColors.indexOf(e.charAt(1));return{point:allPoints[t],suit:allSuits[r]}}function cardEncoder(e){var t=allPoints.indexOf(e.point),r=allSuits.indexOf(e.suit);return""+allNumbers[t]+allColors[r]}exports.shuffleCards=shuffleCards,exports.digestHand=digestHand,exports.compareHands=compareHands,exports.cardDecoder=cardDecoder,exports.cardEncoder=cardEncoder;